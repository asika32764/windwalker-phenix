{"version":3,"sources":["modal-field.js"],"names":["$","window","Phoenix","Field","Modal","elements","select","selector","value","title","ele","find","attr","trigger","delay","effect","css","image","modal","selectAsTag","selected","length","is","alert","__","prop","newOption","Option","append","selectAsList","modalList","data","ModalList","items","options","$ele","template","underscore","itemTemplate","html","render","forEach","item","highlight","list","itemHtml","on","e","$btn","currentTarget","parents","slideUp","remove","toggleRequired","placeholder","console","log"],"mappings":"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","file":"modal-field.js","sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2018 ${ORGANIZATION}.\n * @license    __LICENSE__\n */\n\n// Phoenix.Field.Modal\n$(() => {\n  window.Phoenix = window.Phoenix || {};\n  window.Phoenix.Field = window.Phoenix.Field || {};\n\n  window.Phoenix.Field.Modal = {\n    elements: {},\n    select(selector, value, title) {\n      const ele = $(selector);\n\n      if (typeof value !== 'object') {\n        value = {\n          value: value,\n          title: title\n        };\n      }\n\n      ele.find('.input-group input').attr('value', value.title).trigger('change').delay(250).effect('highlight');\n      ele.find('input[data-value-store]').attr('value', value.value).trigger('change');\n      ele.find('.modal-field-image-preview').css('background-image', `url(${value.image})`);\n\n      $('#phoenix-iframe-modal').modal('hide');\n    },\n    selectAsTag(selector, value, title) {\n      const ele = $(selector);\n      const select = ele.find('[data-value-store]');\n\n      if (typeof value !== 'object') {\n        value = {\n          value: value,\n          title: title\n        };\n      }\n\n      const selected = select.find(`option[value='${value.value}']`);\n\n      if (selected.length) {\n        if (selected.is(':checked')) {\n          alert(Phoenix.__('phoenix.form.field.modal.already.selected'));\n        } else {\n          selected.prop('selected', true).trigger('change');\n\n          $('#phoenix-iframe-modal').modal('hide');\n        }\n      } else {\n        const newOption = new Option(value.title, value.value, true, true);\n        select.append(newOption).trigger('change');\n\n        $('#phoenix-iframe-modal').modal('hide');\n      }\n    },\n    selectAsList(selector, value, title) {\n      const ele = $(selector);\n      const modalList = ele.data('modal-list');\n\n      if (typeof value !== 'object') {\n        value = {\n          value: value,\n          title: title\n        };\n      }\n\n      if (ele.find(`[data-value='${value.value}']`).length === 0) {\n        modalList.append(value, true);\n\n        $('#phoenix-iframe-modal').modal('hide');\n      } else {\n        alert(Phoenix.__('phoenix.form.field.modal.already.selected'));\n      }\n    }\n  };\n\n  window.Phoenix.Field.ModalList = class {\n    constructor(selector, items = [], options = {}) {\n      this.$ele = $(selector);\n      this.options = options;\n      this.items = items;\n      this.template = underscore.template($(this.options.itemTemplate).html());\n      this.render();\n\n      this.$ele.data('modal-list', this);\n    }\n\n    render() {\n      this.items.forEach((item) => {\n        this.append(item);\n      });\n    }\n\n    append(item, highlight = false) {\n      const list = this.$ele.find('.modal-list-container');\n\n      const itemHtml = $(this.template(item));\n\n      itemHtml.attr('data-value', item.value);\n\n      itemHtml.find('.modal-list-item-delete button').on('click', (e) => {\n        const $btn = $(e.currentTarget);\n\n        const item = $btn.parents('.list-group-item');\n\n        item.slideUp(400, () => {\n          item.remove();\n          this.toggleRequired();\n        });\n      });\n\n      list.append(itemHtml);\n      this.toggleRequired();\n\n      if (highlight) {\n        itemHtml.effect('highlight');\n      }\n    }\n\n    toggleRequired() {\n      const items = this.$ele.find('[data-value-store]');\n      const placeholder = this.$ele.find('[data-validation-placeholder]');\n      console.log(items.length);\n      placeholder.attr('disabled', items.length !== 0);\n    }\n  }\n});\n"]}