"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(e){var t=function(e,t,n){},n=function(){function n(t,i,s){_classCallCheck(this,n),this.element=t,this.options=e.extend(!0,{},this.constructor.defaultOptions,s),this.dependent=e(i),this.bindEvents(),this.options.initial_load&&this.changeList(this.dependent.val(),!0)}return _createClass(n,null,[{key:"pluginName",get:function(){return"listDependent"}},{key:"defaultOptions",get:function(){return{ajax:{url:null,value_field:"value"},source:null,text_field:"title",value_field:"id",first_option:null,default_value:null,initial_load:!0,empty_mark:"__EMPTY__",hooks:{before_request:t,after_request:t}}}}]),_createClass(n,[{key:"bindEvents",value:function(){var t=this;this.dependent.on("change",function(n){t.changeList(e(n.currentTarget).val())})}},{key:"changeList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;""===(e=e||this.dependent.val())&&(e=this.options.empty_mark),this.options.ajax.url?this.ajaxUpdate(e):this.options.source&&this.sourceUpdate(e,t)}},{key:"sourceUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.options.source;this.beforeHook(e,this.element,this.dependent),n[e]?this.updateListElements(n[e]):(this.updateListElements([]),t||""===e||0===parseInt(e)||console.log("List for value: "+e+" not found.")),this.afterHook(e,this.element,this.dependent)}},{key:"ajaxUpdate",value:function(t){var n=this,i={};i[this.options.ajax.value_field]=t,this.beforeHook(t,this.element,this.dependent),e.get(this.options.ajax.url,i).done(function(e){e.success?n.updateListElements(e.data):console.error(e.message)}).fail(function(e){console.error(e.message)}).always(function(){n.afterHook(t,n.element,n.dependent)})}},{key:"updateListElements",value:function(t){var n=this,i=this.options.text_field,s=this.options.value_field;n.element.empty(),this.options.first_option&&(t.unshift({}),t[0][i]=this.options.first_option[i],t[0][s]=this.options.first_option[s]),e.each(t,function(){var t=this[s],o=e("<option>"+this[i]+"</option>");o.attr("value",t),this.attributes&&e.each(this.attributes,function(e){o.attr(e,this)}),n.options.default_value==t&&o.attr("selected","selected"),n.element.append(o)}),n.element.trigger("chosen:updated"),n.element.trigger("change")}},{key:"beforeHook",value:function(e,t,n){return this.options.hooks.before_request.call(this,e,t,n)}},{key:"afterHook",value:function(e,t,n){return this.options.hooks.after_request.call(this,e,t,n)}}]),n}();e.fn[n.pluginName]=function(e,t){return this.data("phoenix."+n.pluginName)||this.data("phoenix."+n.pluginName,new n(this,e,t)),this.data("phoenix."+n.pluginName)}}(jQuery);