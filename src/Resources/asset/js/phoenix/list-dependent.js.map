{"version":3,"sources":["list-dependent.js"],"names":["$","plugin","nope","value","ele","dep","defaultOptions","ajax","url","value_field","source","text_field","first_option","default_value","initial_load","empty_mark","hooks","before_request","after_request","ListDependent","$element","dependent","options","element","extend","bindEvents","changeList","val","prototype","self","on","event","$this","initial","ajaxUpdate","sourceUpdate","beforeHook","updateListElements","parseInt","console","log","afterHook","uri","SimpleURI","setVar","get","toString","done","response","success","data","error","message","fail","always","items","textField","valueField","empty","unshift","each","option","attr","attributes","index","append","trigger","before","call","after","fn","jQuery"],"mappings":"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","file":"list-dependent.js","sourcesContent":["/**\r\n * Part of phoenix project.\r\n *\r\n * @copyright  Copyright (C) 2017 {ORGANIZATION}. All rights reserved.\r\n * @license    GNU General Public License version 2 or later.\r\n */\r\n\r\n;(function($) {\r\n  \"use strict\";\r\n\r\n  var plugin = 'listDependent';\r\n\r\n  var nope = function(value, ele, dep) {\r\n  };\r\n\r\n  var defaultOptions = {\r\n    ajax: {\r\n      url: null,\r\n      value_field: 'value'\r\n    },\r\n    source: null,\r\n    text_field: 'title',\r\n    value_field: 'id',\r\n    first_option: null,\r\n    default_value: null,\r\n    initial_load: true,\r\n    empty_mark: '__EMPTY__',\r\n    hooks: {\r\n      before_request: nope,\r\n      after_request: nope\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Class init.\r\n   * @param {jQuery}        $element\r\n   * @param {jQuery|string} dependent\r\n   * @param {Object}        options\r\n   * @constructor\r\n   */\r\n  var ListDependent = function($element, dependent, options) {\r\n    this.element = $element;\r\n    this.options = $.extend(true, {}, defaultOptions, options);\r\n    this.dependent = $(dependent);\r\n\r\n    this.bindEvents();\r\n\r\n    if (this.options.initial_load) {\r\n      this.changeList(this.dependent.val(), true);\r\n    }\r\n  };\r\n\r\n  ListDependent.prototype = {\r\n\r\n    /**\r\n     * Bind events.\r\n     */\r\n    bindEvents: function() {\r\n      var self = this;\r\n\r\n      this.dependent.on('change', function(event) {\r\n        var $this = $(this);\r\n        self.changeList($this.val());\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Update the list elements.\r\n     *\r\n     * @param {*}    value\r\n     * @param {bool} initial\r\n     */\r\n    changeList: function(value, initial) {\r\n      value = value || this.dependent.val();\r\n\r\n      // Empty mark\r\n      if (value === '') {\r\n        value = this.options.empty_mark;\r\n      }\r\n\r\n      if (this.options.ajax.url) {\r\n        this.ajaxUpdate(value);\r\n      } else if (this.options.source) {\r\n        this.sourceUpdate(value, initial);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Update list by source.\r\n     *\r\n     * @param {string} value\r\n     * @param {bool}   initial\r\n     */\r\n    sourceUpdate: function(value, initial) {\r\n      var self = this;\r\n      var source = this.options.source;\r\n\r\n      this.beforeHook(value, self.element, self.dependent);\r\n\r\n      if (source[value]) {\r\n        this.updateListElements(source[value]);\r\n      } else {\r\n        this.updateListElements([]);\r\n\r\n        if (!initial && value !== '' && parseInt(value) !== 0) {\r\n          console.log('List for value: ' + value + ' not found.');\r\n        }\r\n      }\r\n\r\n      this.afterHook(value, self.element, self.dependent);\r\n    },\r\n\r\n    /**\r\n     * Do ajax.\r\n     *\r\n     * @param {string} value\r\n     */\r\n    ajaxUpdate: function(value) {\r\n      var self = this;\r\n      var uri = new SimpleURI(this.options.ajax.url);\r\n      uri.setVar(this.options.ajax.value_field, value);\r\n\r\n      self.beforeHook(value, self.element, self.dependent);\r\n\r\n      $.get(uri.toString())\r\n        .done(function(response) {\r\n          if (response.success) {\r\n            self.updateListElements(response.data);\r\n          } else {\r\n            console.error(response.message);\r\n          }\r\n        }).fail(function(response) {\r\n        console.error(response.message);\r\n      }).always(function() {\r\n        self.afterHook(value, self.element, self.dependent);\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Update list elements.\r\n     *\r\n     * @param {Array} items\r\n     */\r\n    updateListElements: function(items) {\r\n      var self = this;\r\n      var textField = this.options.text_field;\r\n      var valueField = this.options.value_field;\r\n      self.element.empty();\r\n\r\n      if (this.options.first_option) {\r\n        items.unshift({});\r\n        items[0][textField] = this.options.first_option[textField];\r\n        items[0][valueField] = this.options.first_option[valueField];\r\n      }\r\n\r\n      $.each(items, function() {\r\n        var value = this[valueField];\r\n        var option = $('<option>' + this[textField] + '</option>');\r\n        option.attr('value', value);\r\n\r\n        if (this.attributes) {\r\n          $.each(this.attributes, function(index) {\r\n            option.attr(index, this);\r\n          });\r\n        }\r\n\r\n        if (self.options.default_value == value) {\r\n          option.attr('selected', 'selected');\r\n        }\r\n\r\n        self.element.append(option);\r\n      });\r\n\r\n      self.element.trigger('chosen:updated');\r\n      self.element.trigger('change');\r\n    },\r\n\r\n    /**\r\n     * Before hook.\r\n     *\r\n     * @param {string} value\r\n     * @param {jQuery} element\r\n     * @param {jQuery} dependent\r\n     * @returns {*}\r\n     */\r\n    beforeHook: function(value, element, dependent) {\r\n      var before = this.options.hooks.before_request;\r\n\r\n      return before.call(this, value, element, dependent);\r\n    },\r\n\r\n    /**\r\n     * After hook.\r\n     *\r\n     * @param {string} value\r\n     * @param {jQuery} element\r\n     * @param {jQuery} dependent\r\n     * @returns {*}\r\n     */\r\n    afterHook: function(value, element, dependent) {\r\n      var after = this.options.hooks.after_request;\r\n\r\n      return after.call(this, value, element, dependent);\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Push plugins.\r\n   *\r\n   * @param {jQuery} dependent\r\n   * @param {Object} options\r\n   *\r\n   * @returns {*}\r\n   */\r\n  $.fn[plugin] = function(dependent, options) {\r\n    if (!$.data(this, \"phoenix.\" + plugin)) {\r\n      $.data(this, \"phoenix.\" + plugin, new ListDependent(this, dependent, options));\r\n    }\r\n\r\n    return $.data(this, \"phoenix.\" + plugin);\r\n  };\r\n})(jQuery);\r\n"]}