"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),e}!function(e){var t=function(e,t,n){},n=function(){function n(t,i,o){_classCallCheck(this,n),this.element=t,this.options=e.extend(!0,{},this.constructor.defaultOptions,o),this.dependent=e(i),this.bindEvents(),this.options.initial_load&&this.changeList(this.dependent.val(),!0)}return _createClass(n,null,[{key:"pluginName",get:function(){return"listDependent"}},{key:"defaultOptions",get:function(){return{ajax:{url:null,value_field:"value"},source:null,text_field:"title",value_field:"id",first_option:null,default_value:null,initial_load:!0,empty_mark:"__EMPTY__",hooks:{before_request:t,after_request:t}}}}]),_createClass(n,[{key:"bindEvents",value:function(){var t=this;this.dependent.on("change",function(n){t.changeList(e(n.currentTarget).val())})}},{key:"changeList",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;""===(e=e||this.dependent.val())&&(e=this.options.empty_mark),this.options.ajax.url?this.ajaxUpdate(e):this.options.source&&this.sourceUpdate(e,t)}},{key:"sourceUpdate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.options.source;this.beforeHook(e,this.element,this.dependent),n[e]?this.updateListElements(n[e]):(this.updateListElements([]),t||""===e||0===parseInt(e)||console.log("List for value: "+e+" not found.")),this.afterHook(e,this.element,this.dependent)}},{key:"ajaxUpdate",value:function(e){var t=this,n={};n[this.options.ajax.value_field]=e,this.beforeHook(e,this.element,this.dependent),Phoenix.Ajax.get(this.options.ajax.url,n).done(function(e){e.success?t.updateListElements(e.data):console.error(e.message)}).fail(function(e){console.error(e.message)}).always(function(){t.afterHook(e,t.element,t.dependent)})}},{key:"updateListElements",value:function(t){var n=this,i=this.options.text_field,o=this.options.value_field;this.element.empty(),this.options.first_option&&(t.unshift({}),t[0][i]=this.options.first_option[i],t[0][o]=this.options.first_option[o]),e.each(t,function(t,s){if(Array.isArray(s)){var a=e('<optgroup label="'.concat(t,'"></optgroup>'));return e.each(s,function(e,t){n.appendOptionTo({value:t[o],text:t[i],attributes:t.attributes},a)}),void n.element.append(a)}n.appendOptionTo({value:s[o],text:s[i],attributes:s.attributes},n.element)}),this.element.trigger("chosen:updated"),this.element.trigger("change")}},{key:"appendOptionTo",value:function(t,n){var i=t.value,o=e("<option>"+t.text+"</option>");o.attr("value",i),t.attributes&&e.each(t.attributes,function(e,t){o.attr(e,t)}),this.isSelected(i)&&o.attr("selected","selected"),n.append(o)}},{key:"isSelected",value:function(e){return-1!==(Array.isArray(this.options.default_value)?this.options.default_value:this.options.default_value&&"object"===_typeof(this.options.default_value)?Object.keys(this.options.default_value):[this.options.default_value]).indexOf(e)}},{key:"beforeHook",value:function(e,t,n){return this.options.hooks.before_request.call(this,e,t,n)}},{key:"afterHook",value:function(e,t,n){return this.options.hooks.after_request.call(this,e,t,n)}}]),n}();e.fn[n.pluginName]=function(e,t){return this.data("phoenix."+n.pluginName)||this.data("phoenix."+n.pluginName,new n(this,e,t)),this.data("phoenix."+n.pluginName)}}(jQuery);