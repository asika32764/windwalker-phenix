{"version":3,"sources":["modal-field.js"],"names":["$","window","Phoenix","Field","Modal","elements","select","selector","value","title","ele","find","attr","trigger","delay","effect","modal","selectAsTag","selected","length","is","alert","__","prop","newOption","Option","append","selectAsList","modalList","data","ModalList","items","options","$ele","template","underscore","itemTemplate","html","render","forEach","item","highlight","list","itemHtml","on","e","$btn","currentTarget","parents","slideUp","remove"],"mappings":"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","file":"modal-field.js","sourcesContent":["/**\r\n * Part of earth project.\r\n *\r\n * @copyright  Copyright (C) 2018 ${ORGANIZATION}.\r\n * @license    __LICENSE__\r\n */\r\n\r\n// Phoenix.Field.Modal\r\n$(() => {\r\n  window.Phoenix = window.Phoenix || {};\r\n  window.Phoenix.Field = window.Phoenix.Field || {};\r\n\r\n  window.Phoenix.Field.Modal = {\r\n    elements: {},\r\n    select(selector, value, title) {\r\n      const ele = $(selector);\r\n\r\n      if (typeof value !== 'object') {\r\n        value = {\r\n          value: value,\r\n          title: title\r\n        };\r\n      }\r\n\r\n      ele.find('.input-group input').attr('value', value.title).trigger('change').delay(250).effect('highlight');\r\n      ele.find('input[data-value-store]').attr('value', value.value).trigger('change');\r\n\r\n      $('#phoenix-iframe-modal').modal('hide');\r\n    },\r\n    selectAsTag(selector, value, title) {\r\n      const ele = $(selector);\r\n      const select = ele.find('[data-value-store]');\r\n\r\n      if (typeof value !== 'object') {\r\n        value = {\r\n          value: value,\r\n          title: title\r\n        };\r\n      }\r\n\r\n      const selected = select.find(`option[value='${value.value}']`);\r\n\r\n      if (selected.length) {\r\n        if (selected.is(':checked')) {\r\n          alert(Phoenix.__('phoenix.form.field.modal.already.selected'));\r\n        } else {\r\n          selected.prop('selected', true).trigger('change');\r\n\r\n          $('#phoenix-iframe-modal').modal('hide');\r\n        }\r\n      } else {\r\n        const newOption = new Option(value.title, value.value, true, true);\r\n        select.append(newOption).trigger('change');\r\n\r\n        $('#phoenix-iframe-modal').modal('hide');\r\n      }\r\n    },\r\n    selectAsList(selector, value, title) {\r\n      const ele = $(selector);\r\n      const modalList = ele.data('modal-list');\r\n\r\n      if (typeof value !== 'object') {\r\n        value = {\r\n          value: value,\r\n          title: title\r\n        };\r\n      }\r\n\r\n      if (ele.find(`[data-value='${value.value}']`).length === 0) {\r\n        modalList.append(value, true);\r\n\r\n        $('#phoenix-iframe-modal').modal('hide');\r\n      } else {\r\n        alert(Phoenix.__('phoenix.form.field.modal.already.selected'));\r\n      }\r\n    }\r\n  };\r\n\r\n  window.Phoenix.Field.ModalList = class {\r\n    constructor(selector, items = [], options = {}) {\r\n      this.$ele = $(selector);\r\n      this.options = options;\r\n      this.items = items;\r\n      this.template = underscore.template($(this.options.itemTemplate).html());\r\n      this.render();\r\n\r\n      this.$ele.data('modal-list', this);\r\n    }\r\n\r\n    render() {\r\n      this.items.forEach((item) => {\r\n        this.append(item);\r\n      });\r\n    }\r\n\r\n    append(item, highlight = false) {\r\n      const list = this.$ele.find('.modal-list-container');\r\n\r\n      const itemHtml = $(this.template(item));\r\n\r\n      itemHtml.attr('data-value', item.value);\r\n\r\n      itemHtml.find('.modal-list-item-delete button').on('click', (e) => {\r\n        const $btn = $(e.currentTarget);\r\n\r\n        const item = $btn.parents('.list-group-item');\r\n\r\n        item.slideUp(400, () => {\r\n          item.remove();\r\n        });\r\n      });\r\n\r\n      list.append(itemHtml);\r\n\r\n      if (highlight) {\r\n        itemHtml.effect('highlight');\r\n      }\r\n    }\r\n  }\r\n});\r\n"]}