"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var n,r=_getPrototypeOf(t);if(e){var o=_getPrototypeOf(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(t,e){if(e&&("object"===_typeof(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}!function(t){var e=function(t){_inherits(r,PhoenixJQueryPlugin);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.apply(this,arguments)}return _createClass(r,null,[{key:"is",get:function(){return"Form"}},{key:"proxies",get:function(){return{form:"createPlugin"}}},{key:"pluginName",get:function(){return"form"}},{key:"pluginClass",get:function(){return n}},{key:"defaultOptions",get:function(){return{}}}]),r}(),n=function(){function e(n,r,o){if(_classCallCheck(this,e),0===n.length){n=t("<form>"),0===r.mainSelector.indexOf("#")&&(n.attr("id",r.mainSelector.substr(1)),n.attr("name",r.mainSelector.substr(1))),n.attr("action","post"),n.attr("enctype","multipart/form-data"),n.attr("novalidate","true"),n.attr("action",o.data("phoenix.uri").full),n.css("display","none");var i=t('<input type="hidden" value="" name="">');i.attr("name",o.data("csrfToken")),n.append(i),t("body").append(n)}r=t.extend(!0,{},this.constructor.defaultOptions,r),this.form=n,this.options=r,this.bindEvents()}return _createClass(e,[{key:"bindEvents",value:function(){var e=this;this.form.attr("data-toolbar")&&t(this.form.attr("data-toolbar")).find("*[data-action]").on("click",function(t){e.form.trigger("phoenix.submit",t.currentTarget)}),this.form.on("phoenix.submit",function(n,r){var o=t(r),i=o.attr("data-action"),u=o.attr("data-target")||null,a=o.data("query")||{};a.task=o.attr("data-task")||null,e[i](u,a)})}},{key:"submit",value:function(e,n,r,o){var i=this,u=this.form;if(o){var a=u.find('input[name="_method"]');a.length||(a=t('<input name="_method" type="hidden">'),u.append(a)),a.val(o)}if(n){var c,f=this.constructor.flattenObject(n);t.each(f,function(e,n){var r=i.constructor.buildFieldName(e);(c=u.find('input[name="'+r+'"]')).length||(c=t('<input name="'+r+'" type="hidden">'),u.append(c)),c.val(n)})}return e&&u.attr("action",e),r&&u.attr("method",r),u.submit(),!0}},{key:"get",value:function(t,e,n){return this.submit(t,e,"GET",n)}},{key:"post",value:function(t,e,n){return n=n||"POST",this.submit(t,e,"POST",n)}},{key:"put",value:function(t,e){return this.post(t,e,"PUT")}},{key:"patch",value:function(t,e){return this.post(t,e,"PATCH")}},{key:"sendDelete",value:function(t,e){return this.delete(t,e)}},{key:"delete",value:function(t,e){return this.post(t,e,"DELETE")}}],[{key:"flattenObject",value:function(t){var e={};for(var n in t)if(t.hasOwnProperty(n))if("object"===_typeof(t[n])&&null!=t[n]){var r=this.flattenObject(t[n]);for(var o in r)r.hasOwnProperty(o)&&(e[n+"/"+o]=r[o])}else e[n]=t[n];return e}},{key:"buildFieldName",value:function(t){var e=t.split("/");return e.shift()+e.map(function(t){return"[".concat(t,"]")}).join("")}}]),e}();window.PhoenixForm=e}(jQuery);