!function(t){"use strict";var e={selector:{search:{container:".search-container",button:".search-button",clearButton:".search-clear-button"},filter:{container:".filter-container",button:".filter-toggle-button"},sort:{button:"a[data-sort-button]"}}};function i(i,n,r){this.form=i,this.core=n,this.options=t.extend(!0,{},e,r);var o=this.options.selector;this.searchContainer=this.form.find(o.search.container),this.searchButton=this.form.find(o.search.button),this.searchClearButton=this.form.find(o.search.clearButton),this.filterContainer=this.form.find(o.filter.container),this.filterButton=this.form.find(o.filter.button),this.sortButtons=this.form.find(o.sort.button),this.registerEvents()}i.prototype={registerEvents:function(){var t=this;this.searchClearButton.click(function(e){t.searchContainer.find("input, textarea, select").val(""),t.filterContainer.find("input, textarea, select").val(""),t.form.submit()}),this.filterButton.click(function(e){t.toggleFilter(),e.stopPropagation(),e.preventDefault()}),this.sortButtons.click(function(e){t.sort(this,e)})},toggleFilter:function(){return Phoenix.Theme.toggleFilter(this.filterContainer,this.filterButton),this},sort:function(e,i){var n=this.form.find("input[name=list_ordering]");n.length||(n=t('<input name="list_ordering" type="hidden" value="" />'),this.form.append(n));var r=this.form.find("input[name=list_direction]");return r.length||(r=t('<input name="list_direction" type="hidden" value="" />'),this.form.append(r)),n.val(e),r.val(i),this.core.put()},checkRow:function(t,e){e=e||!0;var i=this.form.find("input.grid-checkbox[data-row-number="+t+"]");if(!i.length)throw new Error("Checkbox of row: "+t+" not found.");i[0].checked=e},updateRow:function(t,e,i){return this.toggleAll(!1),this.checkRow(t),this.core.patch(e,i)},doTask:function(t,e,i,n){return(n=n||{}).task=t,this.updateRow(e,i,n)},batch:function(t,e,i){return(i=i||{}).task=t,this.core.patch(e,i)},copyRow:function(t,e,i){return this.toggleAll(!1),this.checkRow(t),this.core.post(e,i)},deleteList:function(t,e,i){var n=this;return t=t||Phoenix.Translator.translate("phoenix.message.delete.confirm"),this.core.confirm(t,function(t){t&&n.core.delete(e,i)}),!0},deleteRow:function(t,e,i,n){return this.toggleAll(!1),this.checkRow(t),this.deleteList(e,i,n)},toggleAll:function(e,i){var n=this.form.find("input.grid-checkbox[type=checkbox]");return t.each(n,function(t,r){i?setTimeout(function(){r.checked=e},i/n.length*t):r.checked=e}),this},countChecked:function(){return this.getChecked().length},getChecked:function(){var e=this.form.find("input.grid-checkbox[type=checkbox]"),i=[];return t.each(e,function(t,e){e.checked&&i.push(e)}),i},hasChecked:function(t,e){if(t=t||Phoenix.Translator.translate("phoenix.message.grid.checked"),!this.countChecked())throw alert(t),e&&(e.stopPropagation(),e.preventDefault()),new Error(t);return this},reorderAll:function(e,i){var n=this,r=this.form.find("input[name=origin_ordering]");if(r.length){var o=r.val().split(","),h=this.form.find(".ordering-control input");this.toggleAll(!1),h.each(function(e){var i=t(this);if(i.val()!==o[e]){n.checkRow(i.data("order-row"));var r=i.parents("tr"),h=r.data("order-group");""!==h&&r.siblings("[data-order-group="+h+"]").find("input.grid-checkbox").prop("checked",!0)}})}return this.batch("reorder",e,i)},reorder:function(t,e,i,n){return(n=n||{}).delta=e,this.doTask("reorder",t,i,n)}},t.fn.grid=function(t,e){return this.data("phoenix.grid")||this.data("phoenix.grid",new i(this,t,e)),this.data("phoenix.grid")}}(jQuery);