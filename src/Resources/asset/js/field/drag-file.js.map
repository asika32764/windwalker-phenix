{"version":3,"sources":["drag-file.js"],"names":["$","swal","window","title","message","alert","Phoenix","plugin","$element","$options","on","e","$self","currentTarget","files","limit","attr","sizeLimit","placeholder","acceptExtensions","split","map","v","trim","filter","length","text","__","preventDefault","fileSize","Array","prototype","forEach","call","file","indexOf","name","pop","toLowerCase","join","Error","size","next","find","html","addClass","removeClass","trigger"],"mappings":";;;;AAAA;;;;;;AAOA;AACAA,CAAC,CAAC,YAAM;AACN;AACA,MAAMC,IAAI,GAAGC,MAAM,CAACD,IAAP,IAAe,SAASA,IAAT,CAAcE,KAAd,EAAqC;AAAA,QAAhBC,OAAgB,uEAAN,IAAM;AAC/DC,IAAAA,KAAK,CAACF,KAAK,GAAG,KAAR,GAAgBC,OAAjB,CAAL;AACD,GAFD;;AAIAE,EAAAA,OAAO,CAACC,MAAR,CAAe,UAAf;AAAA;AAAA;AACE,oBAAYC,QAAZ,EAAsBC,QAAtB,EAAgC;AAAA;;AAC9BD,MAAAA,QAAQ,CAACE,EAAT,CAAY,QAAZ,EAAsB,UAAAC,CAAC,EAAI;AACvB,YAAMC,KAAK,GAAGZ,CAAC,CAACW,CAAC,CAACE,aAAH,CAAf,CADuB,CAGvB;;AACA,YAAMC,KAAK,GAAGF,KAAK,CAAC,CAAD,CAAL,CAASE,KAAvB;AACA,YAAMC,KAAK,GAAGH,KAAK,CAACI,IAAN,CAAW,gBAAX,CAAd;AACA,YAAMC,SAAS,GAAGL,KAAK,CAACI,IAAN,CAAW,eAAX,CAAlB;AACA,YAAIE,WAAW,GAAGN,KAAK,CAACI,IAAN,CAAW,aAAX,CAAlB;AACA,YAAMG,gBAAgB,GAAG,CAACP,KAAK,CAACI,IAAN,CAAW,eAAX,KAA+B,EAAhC,EACtBI,KADsB,CAChB,GADgB,EAEtBC,GAFsB,CAElB,UAAAC,CAAC;AAAA,iBAAIA,CAAC,CAACC,IAAF,EAAJ;AAAA,SAFiB,EAGtBC,MAHsB,CAGf,UAAAF,CAAC;AAAA,iBAAIA,CAAC,CAACG,MAAF,GAAW,CAAf;AAAA,SAHc,CAAzB;AAIA,YAAIC,IAAJ;;AAEA,YAAI,CAACR,WAAL,EAAkB;AAChB,cAAIN,KAAK,CAACI,IAAN,CAAW,UAAX,CAAJ,EAA4B;AAC1BE,YAAAA,WAAW,GAAGZ,OAAO,CAACqB,EAAR,CAAW,mDAAX,CAAd;AACD,WAFD,MAEO;AACLT,YAAAA,WAAW,GAAGZ,OAAO,CAACqB,EAAR,CAAW,iDAAX,CAAd;AACD;AACF,SApBsB,CAsBvB;;;AACA,YAAIZ,KAAK,IAAID,KAAK,CAACW,MAAN,GAAeV,KAA5B,EAAmC;AACjCd,UAAAA,IAAI,CAACK,OAAO,CAACqB,EAAR,CAAW,gDAAX,EAA6DZ,KAA7D,CAAD,EAAsE,EAAtE,EAA0E,SAA1E,CAAJ;AACAJ,UAAAA,CAAC,CAACiB,cAAF;AACA;AACD,SA3BsB,CA6BvB;;;AACA,YAAIC,QAAQ,GAAG,CAAf;AACAC,QAAAA,KAAK,CAACC,SAAN,CAAgBC,OAAhB,CAAwBC,IAAxB,CAA6BnB,KAA7B,EAAoC,UAAAoB,IAAI,EAAI;AAC1C,cAAIf,gBAAgB,CAACM,MAAjB,IAA2BN,gBAAgB,CAACgB,OAAjB,CAAyBD,IAAI,CAACE,IAAL,CAAUhB,KAAV,CAAgB,GAAhB,EAAqBiB,GAArB,GAA2BC,WAA3B,EAAzB,MAAuE,CAAC,CAAvG,EAA0G;AACxGrC,YAAAA,IAAI,CACFK,OAAO,CAACqB,EAAR,CAAW,uDAAX,CADE,EAEFrB,OAAO,CAACqB,EAAR,CAAW,4DAAX,EAAyER,gBAAgB,CAACoB,IAAjB,CAAsB,IAAtB,CAAzE,CAFE,EAGF,SAHE,CAAJ;AAKA,kBAAM,IAAIC,KAAJ,CAAU,uBAAV,CAAN;AACD;;AAEDX,UAAAA,QAAQ,IAAIK,IAAI,CAACO,IAAjB;AACD,SAXD;;AAaA,YAAIxB,SAAS,IAAKY,QAAQ,GAAG,IAAX,GAAkB,IAAnB,GAA2BZ,SAA5C,EAAuD;AACrDhB,UAAAA,IAAI,CACFK,OAAO,CAACqB,EAAR,CACE,+CADF,EAEEV,SAAS,GAAG,CAAZ,GAAiBA,SAAS,GAAG,IAAb,GAAqB,IAArC,GAA4CA,SAAS,GAAG,IAF1D,CADE,EAKF,EALE,EAMF,SANE,CAAJ;AAQAN,UAAAA,CAAC,CAACiB,cAAF;AACA;AACD;;AAED,YAAId,KAAK,CAACW,MAAN,GAAe,CAAnB,EAAsB;AACpBC,UAAAA,IAAI,+EACMpB,OAAO,CAACqB,EAAR,CAAW,uCAAX,EAAoDb,KAAK,CAACW,MAA1D,CADN,CAAJ;AAED,SAHD,MAGO,IAAIX,KAAK,CAACW,MAAN,KAAiB,CAArB,EAAwB;AAC7BC,UAAAA,IAAI,gDAAuCZ,KAAK,CAAC,CAAD,CAAL,CAASsB,IAAhD,CAAJ;AACD,SAFM,MAEA;AACLV,UAAAA,IAAI,kDAAyCR,WAAzC,CAAJ;AACD,SAhEsB,CAkEvB;;;AACAN,QAAAA,KAAK,CAAC8B,IAAN,CAAW,oBAAX,EAAiCC,IAAjC,CAAsC,MAAtC,EAA8CC,IAA9C,CAAmDlB,IAAnD;AACD,OApEH,EAqEGhB,EArEH,CAqEM,UArEN,EAqEkB,UAAAC,CAAC,EAAI;AACnBX,QAAAA,CAAC,CAACW,CAAC,CAACE,aAAH,CAAD,CAAmBgC,QAAnB,CAA4B,OAA5B;AACD,OAvEH,EAwEGnC,EAxEH,CAwEM,WAxEN,EAwEmB,UAAAC,CAAC,EAAI;AACpBX,QAAAA,CAAC,CAACW,CAAC,CAACE,aAAH,CAAD,CAAmBiC,WAAnB,CAA+B,OAA/B;AACD,OA1EH,EA2EGpC,EA3EH,CA2EM,MA3EN,EA2Ec,UAAAC,CAAC,EAAI;AACfX,QAAAA,CAAC,CAACW,CAAC,CAACE,aAAH,CAAD,CAAmBiC,WAAnB,CAA+B,OAA/B;AACD,OA7EH,EA8EGC,OA9EH,CA8EW,QA9EX;AA+ED;;AAjFH;AAAA;AAmFD,CAzFA,CAAD","sourcesContent":["/**\n * Part of afb project.\n *\n * @copyright  Copyright (C) 2018 ${ORGANIZATION}.\n * @license    __LICENSE__\n */\n\n// Custom file input\n$(() => {\n  // Polyfill sweetalert\n  const swal = window.swal || function swal(title, message = null) {\n    alert(title + ' / ' + message);\n  };\n\n  Phoenix.plugin('dragFile', class {\n    constructor($element, $options) {\n      $element.on('change', e => {\n          const $self = $(e.currentTarget);\n\n          //get the file name\n          const files = $self[0].files;\n          const limit = $self.attr('data-max-files');\n          const sizeLimit = $self.attr('data-max-size');\n          let placeholder = $self.attr('placeholder');\n          const acceptExtensions = ($self.attr('data-accepted') || '')\n            .split(',')\n            .map(v => v.trim())\n            .filter(v => v.length > 0);\n          let text;\n\n          if (!placeholder) {\n            if ($self.attr('multiple')) {\n              placeholder = Phoenix.__('phoenix.form.field.drag.file.placeholder.multiple');\n            } else {\n              placeholder = Phoenix.__('phoenix.form.field.drag.file.placeholder.single');\n            }\n          }\n\n          // Files limit\n          if (limit && files.length > limit) {\n            swal(Phoenix.__('phoenix.form.field.drag.file.message.max.files', limit), '', 'warning');\n            e.preventDefault();\n            return;\n          }\n\n          // Files size\n          let fileSize = 0;\n          Array.prototype.forEach.call(files, file => {\n            if (acceptExtensions.length && acceptExtensions.indexOf(file.name.split('.').pop().toLowerCase()) === -1) {\n              swal(\n                Phoenix.__('phoenix.form.field.drag.file.message.unaccepted.files'),\n                Phoenix.__('phoenix.form.field.drag.file.message.unaccepted.files.desc', acceptExtensions.join(', ')),\n                'warning'\n              );\n              throw new Error('Not accepted file ext');\n            }\n\n            fileSize += file.size;\n          });\n\n          if (sizeLimit && (fileSize / 1024 / 1024) > sizeLimit) {\n            swal(\n              Phoenix.__(\n                'phoenix.form.field.drag.file.message.max.size',\n                sizeLimit < 1 ? (sizeLimit * 1024) + 'KB' : sizeLimit + 'MB'\n              ),\n              '',\n              'warning'\n            );\n            e.preventDefault();\n            return;\n          }\n\n          if (files.length > 1) {\n            text = `<span class=\"fa fa-files fa-copy\"></span> \n                    ${Phoenix.__('phoenix.form.field.drag.file.selected', files.length)}`;\n          } else if (files.length === 1) {\n            text = `<span class=\"fa fa-file\"></span> ${files[0].name}`;\n          } else {\n            text = `<span class=\"fa fa-upload\"></span> ${placeholder}`;\n          }\n\n          //replace the \"Choose a file\" label\n          $self.next('.custom-file-label').find('span').html(text);\n        })\n        .on('dragover', e => {\n          $(e.currentTarget).addClass('hover');\n        })\n        .on('dragleave', e => {\n          $(e.currentTarget).removeClass('hover');\n        })\n        .on('drop', e => {\n          $(e.currentTarget).removeClass('hover');\n        })\n        .trigger('change');\n    }\n  });\n});\n"],"file":"drag-file.js"}