{"version":3,"sources":["modal-field.js"],"names":["$","window","Phoenix","Field","Modal","elements","select","selector","value","title","ele","find","attr","trigger","delay","effect","css","image","modal","selectAsTag","selected","length","is","alert","__","prop","newOption","Option","append","selectAsList","modalList","data","ModalList","items","options","$ele","template","underscore","itemTemplate","html","render","forEach","item","highlight","list","itemHtml","on","e","$btn","currentTarget","parents","slideUp","remove","toggleRequired","placeholder","event","preventDefault","stopPropagation","max","open"],"mappings":"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","sourcesContent":["/**\n * Part of earth project.\n *\n * @copyright  Copyright (C) 2018 ${ORGANIZATION}.\n * @license    __LICENSE__\n */\n\n// Phoenix.Field.Modal\n$(() => {\n  window.Phoenix = window.Phoenix || {};\n  window.Phoenix.Field = window.Phoenix.Field || {};\n\n  window.Phoenix.Field.Modal = {\n    elements: {},\n    select(selector, value, title) {\n      const ele = $(selector);\n\n      if (typeof value !== 'object') {\n        value = {\n          value: value,\n          title: title\n        };\n      }\n\n      ele.find('.input-group input').attr('value', value.title).trigger('change').delay(250).effect('highlight');\n      ele.find('input[data-value-store]').attr('value', value.value).trigger('change');\n      ele.find('.modal-field-image-preview').css('background-image', `url(${value.image})`);\n\n      $('#phoenix-iframe-modal').modal('hide');\n    },\n    selectAsTag(selector, value, title) {\n      const ele = $(selector);\n      const select = ele.find('[data-value-store]');\n\n      if (typeof value !== 'object') {\n        value = {\n          value: value,\n          title: title\n        };\n      }\n\n      const selected = select.find(`option[value='${value.value}']`);\n\n      if (selected.length) {\n        if (selected.is(':checked')) {\n          alert(Phoenix.__('phoenix.form.field.modal.already.selected'));\n        } else {\n          selected.prop('selected', true).trigger('change');\n\n          $('#phoenix-iframe-modal').modal('hide');\n        }\n      } else {\n        const newOption = new Option(value.title, value.value, true, true);\n        select.append(newOption).trigger('change');\n\n        $('#phoenix-iframe-modal').modal('hide');\n      }\n    },\n    selectAsList(selector, value, title) {\n      const ele = $(selector);\n      const modalList = ele.data('modal-list');\n\n      if (typeof value !== 'object') {\n        value = {\n          value: value,\n          title: title\n        };\n      }\n\n      if (ele.find(`[data-value='${value.value}']`).length === 0) {\n        modalList.append(value, true);\n\n        $('#phoenix-iframe-modal').modal('hide');\n      } else {\n        alert(Phoenix.__('phoenix.form.field.modal.already.selected'));\n      }\n    }\n  };\n\n  window.Phoenix.Field.ModalList = class {\n    constructor(selector, items = [], options = {}) {\n      this.$ele = $(selector);\n      this.options = options;\n      this.items = items;\n      this.template = underscore.template($(this.options.itemTemplate).html());\n      this.render();\n\n      this.$ele.data('modal-list', this);\n    }\n\n    render() {\n      this.items.forEach((item) => {\n        this.append(item);\n      });\n    }\n\n    append(item, highlight = false) {\n      const list = this.$ele.find('.modal-list-container');\n\n      const itemHtml = $(this.template(item));\n\n      itemHtml.attr('data-value', item.value);\n\n      itemHtml.find('.modal-list-item-delete button').on('click', (e) => {\n        const $btn = $(e.currentTarget);\n\n        const item = $btn.parents('.list-group-item');\n\n        item.slideUp(400, () => {\n          item.remove();\n          this.toggleRequired();\n        });\n      });\n\n      list.append(itemHtml);\n      this.toggleRequired();\n\n      if (highlight) {\n        itemHtml.effect('highlight');\n      }\n    }\n\n    toggleRequired() {\n      const items = this.$ele.find('[data-value-store]');\n      const placeholder = this.$ele.find('[data-validation-placeholder]');\n\n      placeholder.attr('disabled', items.length !== 0);\n    }\n\n    open(event) {\n      event.preventDefault();\n      event.stopPropagation();\n\n      const max = this.$ele.attr('data-max-items');\n\n      if (!max) {\n        Phoenix.Modal.open($(event.currentTarget).attr('href'));\n        return;\n      }\n\n      if ($('.modal-list-container .list-group-item').length >= max) {\n        alert(\n          Phoenix.__('phoenix.form.field.modal.max.selected', max)\n        );\n\n        return;\n      }\n\n      Phoenix.Modal.open($(event.currentTarget).attr('href'));\n    }\n  }\n});\n"],"file":"modal-field.js"}