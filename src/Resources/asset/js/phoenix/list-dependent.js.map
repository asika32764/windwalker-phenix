{"version":3,"sources":["list-dependent.js"],"names":["$","nope","value","ele","dep","ListDependent","$element","dependent","options","element","extend","constructor","defaultOptions","bindEvents","initial_load","changeList","val","on","event","currentTarget","initial","empty_mark","ajax","url","ajaxUpdate","source","sourceUpdate","beforeHook","updateListElements","parseInt","console","log","afterHook","data","value_field","$xhr","abort","Phoenix","Ajax","get","done","response","success","error","message","fail","err","always","items","self","textField","text_field","valueField","empty","first_option","unshift","each","i","item","Array","isArray","group","k","child","appendOptionTo","text","attributes","append","trigger","parent","option","attr","index","isSelected","defaultValues","default_value","Object","keys","indexOf","before","hooks","before_request","call","after","after_request","fn","pluginName","jQuery"],"mappings":"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","sourcesContent":["/**\n * Part of phoenix project.\n *\n * @copyright  Copyright (C) 2017 {ORGANIZATION}. All rights reserved.\n * @license    GNU General Public License version 2 or later.\n */\n\n;(function($) {\n  \"use strict\";\n\n  const nope = (value, ele, dep) => {};\n\n  /**\n   * Class init.\n   * @param {jQuery}        $element\n   * @param {jQuery|string} dependent\n   * @param {Object}        options\n   * @constructor\n   */\n  class ListDependent {\n    $xhr = null;\n\n    static get pluginName() { return 'listDependent' }\n    static get defaultOptions() {\n      return {\n        ajax: {\n          url: null,\n          value_field: 'value'\n        },\n        source: null,\n        text_field: 'title',\n        value_field: 'id',\n        first_option: null,\n        default_value: null,\n        initial_load: true,\n        empty_mark: '__EMPTY__',\n        hooks: {\n          before_request: nope,\n          after_request: nope\n        }\n      };\n    }\n\n    constructor($element, dependent, options) {\n      this.element = $element;\n      this.options = $.extend(true, {}, this.constructor.defaultOptions, options);\n      this.dependent = $(dependent);\n\n      this.bindEvents();\n\n      if (this.options.initial_load) {\n        this.changeList(this.dependent.val(), true);\n      }\n    }\n\n    /**\n     * Bind events.\n     */\n    bindEvents() {\n      this.dependent.on('change', (event) => {\n        this.changeList($(event.currentTarget).val());\n      });\n    }\n\n    /**\n     * Update the list elements.\n     *\n     * @param {*}    value\n     * @param {bool} initial\n     */\n    changeList(value, initial = null) {\n      value = value || this.dependent.val();\n\n      // Empty mark\n      if (value === '') {\n        value = this.options.empty_mark;\n      }\n\n      if (this.options.ajax.url) {\n        this.ajaxUpdate(value);\n      } else if (this.options.source) {\n        this.sourceUpdate(value, initial);\n      }\n    }\n\n    /**\n     * Update list by source.\n     *\n     * @param {string} value\n     * @param {bool}   initial\n     */\n    sourceUpdate(value, initial = null) {\n      const source = this.options.source;\n\n      this.beforeHook(value, this.element, this.dependent);\n\n      if (source[value]) {\n        this.updateListElements(source[value]);\n      } else {\n        this.updateListElements([]);\n\n        if (!initial && value !== '' && parseInt(value) !== 0) {\n          console.log('List for value: ' + value + ' not found.');\n        }\n      }\n\n      this.afterHook(value, this.element, this.dependent);\n    }\n\n    /**\n     * Do ajax.\n     *\n     * @param {string} value\n     */\n    ajaxUpdate(value) {\n      const data = {};\n      data[this.options.ajax.value_field] = value;\n\n      this.beforeHook(value, this.element, this.dependent);\n\n      if (this.$xhr) {\n        this.$xhr.abort();\n        this.$xhr = null;\n      }\n\n      this.$xhr = Phoenix.Ajax.get(this.options.ajax.url, data)\n        .done(response => {\n          if (response.success) {\n            this.updateListElements(response.data);\n          } else {\n            console.error(response.message);\n          }\n        }).fail(err => {\n          console.error(err);\n        }).always(() => {\n          this.afterHook(value, this.element, this.dependent);\n          this.$xhr = null;\n        });\n    }\n\n    /**\n     * Update list elements.\n     *\n     * @param {Array} items\n     */\n    updateListElements(items) {\n      const self = this;\n      const textField = this.options.text_field;\n      const valueField = this.options.value_field;\n      self.element.empty();\n\n      if (this.options.first_option) {\n        items.unshift({});\n        items[0][textField] = this.options.first_option[textField];\n        items[0][valueField] = this.options.first_option[valueField];\n      }\n\n      $.each(items, (i, item) => {\n        if (Array.isArray(item)) {\n          const group = $(`<optgroup label=\"${i}\"></optgroup>`);\n\n          $.each(item, (k, child) => {\n            this.appendOptionTo({\n              value: child[valueField],\n              text: child[textField],\n              attributes: child.attributes,\n            }, group);\n          })\n\n          this.element.append(group);\n\n          return;\n        }\n\n        this.appendOptionTo({\n          value: item[valueField],\n          text: item[textField],\n          attributes: item.attributes,\n        }, this.element);\n      });\n\n      this.element.trigger('chosen:updated');\n      this.element.trigger('change');\n    }\n\n    appendOptionTo(item, parent) {\n      const value = item.value;\n      const option = $('<option>' + item.text + '</option>');\n      option.attr('value', value);\n\n      if (item.attributes) {\n        $.each(item.attributes, (index, val) => {\n          option.attr(index, val);\n        });\n      }\n\n      if (this.isSelected(value)) {\n        option.attr('selected', 'selected');\n      }\n\n      parent.append(option);\n    }\n\n    isSelected(value) {\n      let defaultValues = '';\n\n      // Convert all types to array\n      if (Array.isArray(this.options.default_value)) {\n        defaultValues = this.options.default_value;\n      } else if (this.options.default_value && typeof this.options.default_value === 'object') {\n        defaultValues = Object.keys(this.options.default_value);\n      } else {\n        defaultValues = [this.options.default_value];\n      }\n\n      return defaultValues.indexOf(value) !== -1;\n    }\n\n    /**\n     * Before hook.\n     *\n     * @param {string} value\n     * @param {jQuery} element\n     * @param {jQuery} dependent\n     * @returns {*}\n     */\n    beforeHook(value, element, dependent) {\n      const before = this.options.hooks.before_request;\n\n      return before.call(this, value, element, dependent);\n    }\n\n    /**\n     * After hook.\n     *\n     * @param {string} value\n     * @param {jQuery} element\n     * @param {jQuery} dependent\n     * @returns {*}\n     */\n    afterHook(value, element, dependent) {\n      const after = this.options.hooks.after_request;\n\n      return after.call(this, value, element, dependent);\n    }\n  }\n\n  /**\n   * Push plugins.\n   *\n   * @param {jQuery} dependent\n   * @param {Object} options\n   *\n   * @returns {*}\n   */\n  $.fn[ListDependent.pluginName] = function(dependent, options) {\n    if (!this.data(\"phoenix.\" + ListDependent.pluginName)) {\n      this.data(\"phoenix.\" + ListDependent.pluginName, new ListDependent(this, dependent, options));\n    }\n\n    return this.data(\"phoenix.\" + ListDependent.pluginName);\n  };\n})(jQuery);\n"],"file":"list-dependent.js"}