{"version":3,"sources":["drag-file.js"],"names":["$","swal","window","title","message","alert","Phoenix","plugin","$element","$options","on","$self","e","currentTarget","files","limit","attr","sizeLimit","placeholder","acceptExtensions","split","map","v","trim","filter","length","text","__","preventDefault","fileSize","Array","prototype","forEach","call","indexOf","file","name","pop","toLowerCase","join","Error","size","next","find","html","addClass","removeClass","trigger"],"mappings":"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","file":"drag-file.js","sourcesContent":["/**\n * Part of afb project.\n *\n * @copyright  Copyright (C) 2018 ${ORGANIZATION}.\n * @license    __LICENSE__\n */\n\n// Custom file input\n$(() => {\n  // Polyfill sweetalert\n  const swal = window.swal || function swal(title, message = null) {\n    alert(title + ' / ' + message);\n  };\n\n  Phoenix.plugin('dragFile', class {\n    constructor($element, $options) {\n      $element.on('change', e => {\n          const $self = $(e.currentTarget);\n\n          //get the file name\n          const files = $self[0].files;\n          const limit = $self.attr('data-max-files');\n          const sizeLimit = $self.attr('data-max-size');\n          let placeholder = $self.attr('placeholder');\n          const acceptExtensions = ($self.attr('data-accepted') || '')\n            .split(',')\n            .map(v => v.trim())\n            .filter(v => v.length > 0);\n          let text;\n\n          if (!placeholder) {\n            if ($self.attr('multiple')) {\n              placeholder = Phoenix.__('phoenix.form.field.drag.file.placeholder.multiple');\n            } else {\n              placeholder = Phoenix.__('phoenix.form.field.drag.file.placeholder.single');\n            }\n          }\n\n          // Files limit\n          if (limit && files.length > limit) {\n            swal(Phoenix.__('phoenix.form.field.drag.file.message.max.files', limit), '', 'warning');\n            e.preventDefault();\n            return;\n          }\n\n          // Files size\n          let fileSize = 0;\n          Array.prototype.forEach.call(files, file => {\n            if (acceptExtensions.length && acceptExtensions.indexOf(file.name.split('.').pop().toLowerCase()) === -1) {\n              swal(\n                Phoenix.__('phoenix.form.field.drag.file.message.unaccepted.files'),\n                Phoenix.__('phoenix.form.field.drag.file.message.unaccepted.files.desc', acceptExtensions.join(', ')),\n                'warning'\n              );\n              throw new Error('Not accepted file ext');\n            }\n\n            fileSize += file.size;\n          });\n\n          if (sizeLimit && (fileSize / 1024 / 1024) > sizeLimit) {\n            swal(\n              Phoenix.__(\n                'phoenix.form.field.drag.file.message.max.size',\n                sizeLimit < 1 ? (sizeLimit * 1024) + 'KB' : sizeLimit + 'MB'\n              ),\n              '',\n              'warning'\n            );\n            e.preventDefault();\n            return;\n          }\n\n          if (files.length > 1) {\n            text = `<span class=\"fa fa-files fa-copy\"></span> \n                    ${Phoenix.__('phoenix.form.field.drag.file.selected', files.length)}`;\n          } else if (files.length === 1) {\n            text = `<span class=\"fa fa-file\"></span> ${files[0].name}`;\n          } else {\n            text = `<span class=\"fa fa-upload\"></span> ${placeholder}`;\n          }\n\n          //replace the \"Choose a file\" label\n          $self.next('.custom-file-label').find('span').html(text);\n        })\n        .on('dragover', e => {\n          $(e.currentTarget).addClass('hover');\n        })\n        .on('dragleave', e => {\n          $(e.currentTarget).removeClass('hover');\n        })\n        .on('drop', e => {\n          $(e.currentTarget).removeClass('hover');\n        })\n        .trigger('change');\n    }\n  });\n});\n"]}