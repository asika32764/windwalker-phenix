"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){return function(){var e,n=_getPrototypeOf(t);if(_isNativeReflectConstruct()){var r=_getPrototypeOf(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return _possibleConstructorReturn(this,e)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}!function(t){var e=function(t){_inherits(r,PhoenixJQueryPlugin);var e=_createSuper(r);function r(){return _classCallCheck(this,r),e.apply(this,arguments)}return _createClass(r,null,[{key:"is",get:function(){return"Grid"}},{key:"proxies",get:function(){return{grid:"createPlugin"}}},{key:"pluginName",get:function(){return"grid"}},{key:"pluginClass",get:function(){return n}},{key:"defaultOptions",get:function(){return{}}}]),r}(),n=function(){function e(n,r,o){if(_classCallCheck(this,e),this.form=n,this.options=t.extend(!0,{},this.constructor.defaultOptions,r),this.phoenix=o,this.core=o.form(r.mainSelector),this.ui=o.UI,!this.core)throw new Error("PhoenixGrid is dependent on PhoenixForm");if(!this.ui)throw new Error("PhoenixGrid is dependent on PhoenixUI");var i=this.options.selector;this.searchContainer=this.form.find(i.search.container),this.searchClearButton=this.form.find(i.search.clearButton),this.filterContainer=this.form.find(i.filter.container),this.filterButton=this.form.find(i.filter.button),this.sortButtons=this.form.find(i.sort.button),this.registerEvents()}return _createClass(e,null,[{key:"defaultOptions",get:function(){return{mainSelector:"",selector:{search:{container:".search-container",button:".search-button",clearButton:".search-clear-button"},filter:{container:".filter-container",button:".filter-toggle-button"},sort:{button:"a[data-sort-button]"}}}}}]),_createClass(e,[{key:"registerEvents",value:function(){var t=this;this.searchClearButton.click(function(){t.searchContainer.find("input, textarea, select").val(""),t.filterContainer.find("input, textarea, select").val(""),t.form.submit()}),this.filterButton.click(function(e){t.toggleFilter(),e.stopPropagation(),e.preventDefault()}),this.sortButtons.click(function(t){self.sort(t.currentTarget,t)})}},{key:"toggleFilter",value:function(){return this.ui.toggleFilter(this.filterContainer,this.filterButton),this}},{key:"sort",value:function(e,n){var r=this.form.find("input[name=list_ordering]");r.length||(r=t('<input name="list_ordering" type="hidden" value="" />'),this.form.append(r));var o=this.form.find("input[name=list_direction]");return o.length||(o=t('<input name="list_direction" type="hidden" value="">'),this.form.append(o)),r.val(e),o.val(n),this.core.put()}},{key:"checkRow",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.form.find("input.grid-checkbox[data-row-number="+t+"]");if(!n.length)throw new Error("Checkbox of row: "+t+" not found.");n[0].checked=e}},{key:"updateRow",value:function(t,e,n){return this.toggleAll(!1),this.checkRow(t),this.core.patch(e,n)}},{key:"doTask",value:function(t,e,n,r){return(r=r||{}).task=t,this.updateRow(e,n,r)}},{key:"batch",value:function(t,e,n){return(n=n||{}).task=t,this.core.patch(e,n)}},{key:"copyRow",value:function(t,e,n){return this.toggleAll(!1),this.checkRow(t),this.core.post(e,n)}},{key:"deleteList",value:function(t,e,n){var r=this;return!1!==(t=null==t?this.phoenix.__("phoenix.message.delete.confirm"):t)?this.phoenix.confirm(t,function(t){t&&r.core.delete(e,n)}):this.core.delete(e,n),!0}},{key:"deleteRow",value:function(t,e,n,r){var o=this;return e=e||this.phoenix.__("phoenix.message.delete.confirm"),this.phoenix.confirm(e,function(e){e&&(o.toggleAll(!1),o.checkRow(t),o.deleteList(!1,n,r))}),!0}},{key:"toggleAll",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.form.find("input.grid-checkbox[type=checkbox]");return t.each(r,function(t,o){n?setTimeout(function(){o.checked=e},n/r.length*t):o.checked=e}),this}},{key:"countChecked",value:function(){return this.getChecked().length}},{key:"getChecked",value:function(){var e=this.form.find("input.grid-checkbox[type=checkbox]"),n=[];return t.each(e,function(t,e){e.checked&&n.push(e)}),n}},{key:"hasChecked",value:function(t,e){if(t=t||Phoenix.Translator.translate("phoenix.message.grid.checked"),!this.countChecked())throw alert(t),e&&(e.stopPropagation(),e.preventDefault()),new Error(t);return this}},{key:"reorderAll",value:function(e,n){var r=this,o=this.form.find("input[name=origin_ordering]");if(o.length){var i=o.val().split(","),c=this.form.find(".ordering-control input");this.toggleAll(!1),c.each(function(e){var n=t(this);if(n.val()!==i[e]){r.checkRow(n.attr("data-order-row"));var o=n.parents("tr"),c=o.attr("data-order-group");""!==c&&o.siblings("[data-order-group="+c+"]").find("input.grid-checkbox").prop("checked",!0)}})}return this.batch("reorder",e,n)}},{key:"reorder",value:function(t,e,n,r){return(r=r||{}).delta=e,this.doTask("reorder",t,n,r)}}]),e}();window.PhoenixGrid=e}(jQuery);