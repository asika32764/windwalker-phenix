"use strict";var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}!function(t){var e=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,PhoenixJQueryPlugin),_createClass(e,null,[{key:"is",get:function(){return"Grid"}},{key:"proxies",get:function(){return{grid:"createPlugin"}}},{key:"pluginName",get:function(){return"grid"}},{key:"pluginClass",get:function(){return n}},{key:"defaultOptions",get:function(){return{}}}]),e}(),n=function(){function e(n,r,i){if(_classCallCheck(this,e),this.form=n,this.options=t.extend(!0,{},this.constructor.defaultOptions,r),this.phoenix=i,this.core=i.form(r.mainSelector),this.ui=i.UI,!this.core)throw new Error("PhoenixGrid is dependent on PhoenixForm");if(!this.ui)throw new Error("PhoenixGrid is dependent on PhoenixUI");var o=this.options.selector;this.searchContainer=this.form.find(o.search.container),this.searchClearButton=this.form.find(o.search.clearButton),this.filterContainer=this.form.find(o.filter.container),this.filterButton=this.form.find(o.filter.button),this.sortButtons=this.form.find(o.sort.button),this.registerEvents()}return _createClass(e,null,[{key:"defaultOptions",get:function(){return{mainSelector:"",selector:{search:{container:".search-container",button:".search-button",clearButton:".search-clear-button"},filter:{container:".filter-container",button:".filter-toggle-button"},sort:{button:"a[data-sort-button]"}}}}}]),_createClass(e,[{key:"registerEvents",value:function(){var t=this;this.searchClearButton.click(function(){t.searchContainer.find("input, textarea, select").val(""),t.filterContainer.find("input, textarea, select").val(""),t.form.submit()}),this.filterButton.click(function(e){t.toggleFilter(),e.stopPropagation(),e.preventDefault()}),this.sortButtons.click(function(t){self.sort(t.currentTarget,t)})}},{key:"toggleFilter",value:function(){return this.ui.toggleFilter(this.filterContainer,this.filterButton),this}},{key:"sort",value:function(e,n){var r=this.form.find("input[name=list_ordering]");r.length||(r=t('<input name="list_ordering" type="hidden" value="" />'),this.form.append(r));var i=this.form.find("input[name=list_direction]");return i.length||(i=t('<input name="list_direction" type="hidden" value="">'),this.form.append(i)),r.val(e),i.val(n),this.core.put()}},{key:"checkRow",value:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.form.find("input.grid-checkbox[data-row-number="+t+"]");if(!n.length)throw new Error("Checkbox of row: "+t+" not found.");n[0].checked=e}},{key:"updateRow",value:function(t,e,n){return this.toggleAll(!1),this.checkRow(t),this.core.patch(e,n)}},{key:"doTask",value:function(t,e,n,r){return(r=r||{}).task=t,this.updateRow(e,n,r)}},{key:"batch",value:function(t,e,n){return(n=n||{}).task=t,this.core.patch(e,n)}},{key:"copyRow",value:function(t,e,n){return this.toggleAll(!1),this.checkRow(t),this.core.post(e,n)}},{key:"deleteList",value:function(t,e,n){var r=this;return!1!==(t=null==t?this.phoenix.__("phoenix.message.delete.confirm"):t)?this.phoenix.confirm(t,function(t){t&&r.core.delete(e,n)}):this.core.delete(e,n),!0}},{key:"deleteRow",value:function(t,e,n,r){var i=this;return e=e||this.phoenix.__("phoenix.message.delete.confirm"),this.phoenix.confirm(e,function(e){e&&(i.toggleAll(!1),i.checkRow(t),i.deleteList(!1,n,r))}),!0}},{key:"toggleAll",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this.form.find("input.grid-checkbox[type=checkbox]");return t.each(r,function(t,i){n?setTimeout(function(){i.checked=e},n/r.length*t):i.checked=e}),this}},{key:"countChecked",value:function(){return this.getChecked().length}},{key:"getChecked",value:function(){var e=this.form.find("input.grid-checkbox[type=checkbox]"),n=[];return t.each(e,function(t,e){e.checked&&n.push(e)}),n}},{key:"hasChecked",value:function(t,e){if(t=t||Phoenix.Translator.translate("phoenix.message.grid.checked"),!this.countChecked())throw alert(t),e&&(e.stopPropagation(),e.preventDefault()),new Error(t);return this}},{key:"reorderAll",value:function(e,n){var r=this,i=this.form.find("input[name=origin_ordering]");if(i.length){var o=i.val().split(","),c=this.form.find(".ordering-control input");this.toggleAll(!1),c.each(function(e){var n=t(this);if(n.val()!==o[e]){r.checkRow(n.attr("data-order-row"));var i=n.parents("tr"),c=i.attr("data-order-group");""!==c&&i.siblings("[data-order-group="+c+"]").find("input.grid-checkbox").prop("checked",!0)}})}return this.batch("reorder",e,n)}},{key:"reorder",value:function(t,e,n,r){return(r=r||{}).delta=e,this.doTask("reorder",t,n,r)}}]),e}();window.PhoenixGrid=e}(jQuery);