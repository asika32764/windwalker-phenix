{"version":3,"sources":["repeatable.js"],"names":["window","RepeatableField","name","data","control","id","items","fields","ensureFirstRow","singleArray","hasKey","attrs","max","created","map","prepareItem","makeSureDefaultItem","mounted","$el","dataset","methods","getId","i","item","field","__key","getName","key","addItem","splice","getEmptyItem","$nextTick","el","$refs","$","css","fadeIn","delItem","fadeOut","Phoenix","uniqid","disabled","__disabled","extend","length","push","computed","canAdd"],"mappings":"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","sourcesContent":["/**\n * Part of phoenix project.\n *\n * @copyright  Copyright (C) 2019 ${ORGANIZATION}.\n * @license    __LICENSE__\n */\n\n(() => {\n  window.RepeatableField = {\n    name: 'repeatable-field',\n    data: {\n      control: '',\n      id: '',\n      items: [],\n      fields: [],\n      ensureFirstRow: 0,\n      singleArray: false,\n      hasKey: false,\n      attrs: {},\n      max: null,\n    },\n    created() {\n      this.items.map(this.prepareItem);\n\n      if (this.ensureFirstRow) {\n        this.makeSureDefaultItem();\n      }\n    },\n    mounted() {\n      this.singleArray = this.$el.dataset.singleArray === '1';\n      this.hasKey = this.$el.dataset.hasKey === '1';\n    },\n    methods: {\n      getId(i, item, field) {\n        return `${this.id}-${item.__key}-${field}`;\n      },\n\n      getName(i, item, field) {\n        if (this.singleArray) {\n          if (this.hasKey) {\n            if (field === 'key') {\n              return '';\n            }\n\n            return `${this.control}[${item.key}]`;\n          }\n\n          return `${this.control}[]`;\n        }\n\n        return `${this.control}[${i}][${field}]`;\n      },\n\n      addItem(i) {\n        this.items.splice(i + 1, 0, this.prepareItem(this.getEmptyItem()));\n\n        this.$nextTick(() => {\n          const el = this.$refs['repeat-item-' + (i + 1)][0];\n\n          $(el).css('display', 'none').fadeIn();\n        });\n      },\n\n      delItem(i) {\n        const el = this.$refs['repeat-item-' + i][0];\n\n        $(el).fadeOut(() => {\n          this.items.splice(i, 1);\n\n          if (this.ensureFirstRow) {\n            this.makeSureDefaultItem();\n          }\n        });\n      },\n\n      prepareItem(item) {\n        if (!item.__key) {\n          item.__key = Phoenix.uniqid();\n        }\n\n        if (this.attrs.disabled) {\n          item.__disabled = this.attrs.disabled;\n        }\n\n        return item;\n      },\n\n      getEmptyItem() {\n        return $.extend({}, this.fields);\n      },\n\n      makeSureDefaultItem() {\n        if (this.items.length === 0) {\n          this.items.push(this.prepareItem(this.getEmptyItem()));\n        }\n      }\n    },\n\n    computed: {\n      canAdd() {\n        if (this.max !== null && this.max <= this.items.length) {\n          return false;\n        }\n\n        return true;\n      }\n    }\n  };\n})();\n"],"file":"repeatable.js"}