{"version":3,"sources":["tab-state.js"],"names":["LoadTab","$element","time","tabButtons","find","storageKey","hashCode","location","href","bindEvents","setTimeout","switchTab","on","e","window","localStorage","setItem","$","currentTarget","attr","$el","tab","length","getItem","hasTab","removeItem","parent","removeClass","tabhref","activateTab","seperatorIndex","indexOf","singular","substring","plural","text","hash","word","i","charCodeAt"],"mappings":"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","sourcesContent":["/**\n * Part of Phoenix project.\n *\n * @copyright  Copyright (C) 2016 LYRASOFT. All rights reserved.\n * @license    GNU General Public License version 2 or later;\n */\n\n/**\n * JavaScript behavior to allow selected tab to be remained after save or page reload\n * keeping state in localstorage\n *\n * @see  https://github.com/joomla/joomla-cms/blob/staging/media/system/js/tabs-state.js\n */\n(() => {\n  'use strict';\n\n  class LoadTab {\n    /**\n     * Class init.\n     *\n     * @param {jQuery} $element\n     * @param {Number} time\n     *\n     * @constructor\n     */\n    constructor($element, time) {\n      time = time || 30;\n\n      this.$element = $element;\n      this.tabButtons = $element.find('a[data-toggle=\"tab\"]');\n      this.storageKey = 'tab-href-' + this.hashCode(location.href);\n\n      this.bindEvents();\n\n      setTimeout(() => {\n        this.switchTab();\n      }, time);\n    }\n\n    /**\n     * Bind events.\n     */\n    bindEvents() {\n      this.tabButtons.on('click', e => {\n        // Store the selected tab href in localstorage\n        window.localStorage.setItem(this.storageKey, $(e.currentTarget).attr('href'));\n      });\n    }\n\n    /**\n     * Active tab.\n     *\n     * @param {string} href\n     */\n    activateTab(href) {\n      const $el = this.$element.find(`a[data-toggle=\"tab\"][href*=\"${href}\"]`);\n      $el.tab('show');\n    }\n\n    /**\n     * Has tab.\n     *\n     * @param {string} href\n     *\n     * @returns {*}\n     */\n    hasTab(href) {\n      return this.$element.find(`a[data-toggle=\"tab\"][href*=\"${href}\"]`).length;\n    }\n\n    /**\n     * Switch tab.\n     *\n     * @returns {boolean}\n     */\n    switchTab() {\n      if (localStorage.getItem(this.storageKey)) {\n        // When moving from tab area to a different view\n        if (!this.hasTab(localStorage.getItem(this.storageKey))) {\n          localStorage.removeItem(this.storageKey);\n          return true;\n        }\n\n        // Clean default tabs\n        this.$element.find('a[data-toggle=\"tab\"]').parent().removeClass('active');\n\n        const tabhref = localStorage.getItem(this.storageKey);\n\n        // Add active attribute for selected tab indicated by url\n        this.activateTab(tabhref);\n\n        // Check whether internal tab is selected (in format <tabname>-<id>)\n        const seperatorIndex = tabhref.indexOf('-');\n\n        if (seperatorIndex !== -1) {\n          const singular = tabhref.substring(0, seperatorIndex);\n          const plural = singular + 's';\n\n          this.activateTab(plural);\n        }\n      }\n    }\n\n    /**\n     * Hash code.\n     *\n     * @param {String} text\n     *\n     * @returns {number}\n     */\n    hashCode(text) {\n      let hash = 0;\n      let word;\n\n      if (text.length === 0) {\n        return hash;\n      }\n\n      for (let i = 0; i < text.length; i++) {\n        word = text.charCodeAt(i);\n        hash = ((hash << 5) - hash) + word;\n        hash = hash & hash; // Convert to 32bit integer\n      }\n\n      return hash;\n    }\n  }\n\n  window.LoadTab = LoadTab;\n})();\n"],"file":"tab-state.js"}