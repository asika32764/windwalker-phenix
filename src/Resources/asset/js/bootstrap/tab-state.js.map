{"version":3,"sources":["tab-state.js"],"names":["LoadTab","$element","time","tabButtons","find","storageKey","hashCode","location","href","bindEvents","setTimeout","switchTab","on","window","localStorage","setItem","$","e","currentTarget","attr","$el","tab","length","getItem","hasTab","removeItem","parent","removeClass","tabhref","activateTab","seperatorIndex","indexOf","singular","substring","plural","text","hash","word","i","charCodeAt"],"mappings":";;;;;;AAAA;;;;;;;AAOA;;;;;;AAMA,CAAC,YAAM;AACL;;AADK,MAGCA,OAHD;AAIH;;;;;;;;AAQA,qBAAYC,QAAZ,EAAsBC,IAAtB,EAA4B;AAAA;;AAAA;;AAC1BA,aAAOA,QAAQ,GAAf;;AAEA,WAAKD,QAAL,GAAgBA,QAAhB;AACA,WAAKE,UAAL,GAAkBF,SAASG,IAAT,CAAc,sBAAd,CAAlB;AACA,WAAKC,UAAL,GAAkB,cAAc,KAAKC,QAAL,CAAcC,SAASC,IAAvB,CAAhC;;AAEA,WAAKC,UAAL;;AAEAC,iBAAW,YAAM;AACf,cAAKC,SAAL;AACD,OAFD,EAEGT,IAFH;AAGD;;AAED;;;;;AA1BG;AAAA;AAAA,mCA6BU;AAAA;;AACX,aAAKC,UAAL,CAAgBS,EAAhB,CAAmB,OAAnB,EAA4B,aAAK;AAC/B;AACAC,iBAAOC,YAAP,CAAoBC,OAApB,CAA4B,OAAKV,UAAjC,EAA6CW,EAAEC,EAAEC,aAAJ,EAAmBC,IAAnB,CAAwB,MAAxB,CAA7C;AACD,SAHD;AAID;;AAED;;;;;;AApCG;AAAA;AAAA,kCAyCSX,IAzCT,EAyCe;AAChB,YAAMY,MAAM,KAAKnB,QAAL,CAAcG,IAAd,kCAAkDI,IAAlD,QAAZ;AACAY,YAAIC,GAAJ,CAAQ,MAAR;AACD;;AAED;;;;;;;;AA9CG;AAAA;AAAA,6BAqDIb,IArDJ,EAqDU;AACX,eAAO,KAAKP,QAAL,CAAcG,IAAd,kCAAkDI,IAAlD,SAA4Dc,MAAnE;AACD;;AAED;;;;;;AAzDG;AAAA;AAAA,kCA8DS;AACV,YAAIR,aAAaS,OAAb,CAAqB,UAArB,CAAJ,EAAsC;AACpC;AACA,cAAI,CAAC,KAAKC,MAAL,CAAYV,aAAaS,OAAb,CAAqB,KAAKlB,UAA1B,CAAZ,CAAL,EAAyD;AACvDS,yBAAaW,UAAb,CAAwB,KAAKpB,UAA7B;AACA,mBAAO,IAAP;AACD;;AAED;AACA,eAAKJ,QAAL,CAAcG,IAAd,CAAmB,sBAAnB,EAA2CsB,MAA3C,GAAoDC,WAApD,CAAgE,QAAhE;;AAEA,cAAMC,UAAUd,aAAaS,OAAb,CAAqB,KAAKlB,UAA1B,CAAhB;;AAEA;AACA,eAAKwB,WAAL,CAAiBD,OAAjB;;AAEA;AACA,cAAME,iBAAiBF,QAAQG,OAAR,CAAgB,GAAhB,CAAvB;;AAEA,cAAID,mBAAmB,CAAC,CAAxB,EAA2B;AACzB,gBAAME,WAAWJ,QAAQK,SAAR,CAAkB,CAAlB,EAAqBH,cAArB,CAAjB;AACA,gBAAMI,SAASF,WAAW,GAA1B;;AAEA,iBAAKH,WAAL,CAAiBK,MAAjB;AACD;AACF;AACF;;AAED;;;;;;;;AA1FG;AAAA;AAAA,+BAiGMC,IAjGN,EAiGY;AACb,YAAIC,OAAO,CAAX;AACA,YAAIC,aAAJ;;AAEA,YAAIF,KAAKb,MAAL,KAAgB,CAApB,EAAuB;AACrB,iBAAOc,IAAP;AACD;;AAED,aAAK,IAAIE,IAAI,CAAb,EAAgBA,IAAIH,KAAKb,MAAzB,EAAiCgB,GAAjC,EAAsC;AACpCD,iBAAOF,KAAKI,UAAL,CAAgBD,CAAhB,CAAP;AACAF,iBAAQ,CAACA,QAAQ,CAAT,IAAcA,IAAf,GAAuBC,IAA9B;AACAD,iBAAOA,OAAOA,IAAd,CAHoC,CAGhB;AACrB;;AAED,eAAOA,IAAP;AACD;AAhHE;;AAAA;AAAA;;AAmHLvB,SAAOb,OAAP,GAAiBA,OAAjB;AACD,CApHD","file":"tab-state.js","sourcesContent":["/**\n * Part of Phoenix project.\n *\n * @copyright  Copyright (C) 2016 LYRASOFT. All rights reserved.\n * @license    GNU General Public License version 2 or later;\n */\n\n/**\n * JavaScript behavior to allow selected tab to be remained after save or page reload\n * keeping state in localstorage\n *\n * @see  https://github.com/joomla/joomla-cms/blob/staging/media/system/js/tabs-state.js\n */\n(() => {\n  'use strict';\n\n  class LoadTab {\n    /**\n     * Class init.\n     *\n     * @param {jQuery} $element\n     * @param {Number} time\n     *\n     * @constructor\n     */\n    constructor($element, time) {\n      time = time || 100;\n\n      this.$element = $element;\n      this.tabButtons = $element.find('a[data-toggle=\"tab\"]');\n      this.storageKey = 'tab-href-' + this.hashCode(location.href);\n\n      this.bindEvents();\n\n      setTimeout(() => {\n        this.switchTab();\n      }, time);\n    }\n\n    /**\n     * Bind events.\n     */\n    bindEvents() {\n      this.tabButtons.on('click', e => {\n        // Store the selected tab href in localstorage\n        window.localStorage.setItem(this.storageKey, $(e.currentTarget).attr('href'));\n      });\n    }\n\n    /**\n     * Active tab.\n     *\n     * @param {string} href\n     */\n    activateTab(href) {\n      const $el = this.$element.find(`a[data-toggle=\"tab\"][href*=\"${href}\"]`);\n      $el.tab('show');\n    }\n\n    /**\n     * Has tab.\n     *\n     * @param {string} href\n     *\n     * @returns {*}\n     */\n    hasTab(href) {\n      return this.$element.find(`a[data-toggle=\"tab\"][href*=\"${href}\"]`).length;\n    }\n\n    /**\n     * Switch tab.\n     *\n     * @returns {boolean}\n     */\n    switchTab() {\n      if (localStorage.getItem('tab-href')) {\n        // When moving from tab area to a different view\n        if (!this.hasTab(localStorage.getItem(this.storageKey))) {\n          localStorage.removeItem(this.storageKey);\n          return true;\n        }\n\n        // Clean default tabs\n        this.$element.find('a[data-toggle=\"tab\"]').parent().removeClass('active');\n\n        const tabhref = localStorage.getItem(this.storageKey);\n\n        // Add active attribute for selected tab indicated by url\n        this.activateTab(tabhref);\n\n        // Check whether internal tab is selected (in format <tabname>-<id>)\n        const seperatorIndex = tabhref.indexOf('-');\n\n        if (seperatorIndex !== -1) {\n          const singular = tabhref.substring(0, seperatorIndex);\n          const plural = singular + 's';\n\n          this.activateTab(plural);\n        }\n      }\n    }\n\n    /**\n     * Hash code.\n     *\n     * @param {String} text\n     *\n     * @returns {number}\n     */\n    hashCode(text) {\n      let hash = 0;\n      let word;\n\n      if (text.length === 0) {\n        return hash;\n      }\n\n      for (let i = 0; i < text.length; i++) {\n        word = text.charCodeAt(i);\n        hash = ((hash << 5) - hash) + word;\n        hash = hash & hash; // Convert to 32bit integer\n      }\n\n      return hash;\n    }\n  }\n\n  window.LoadTab = LoadTab;\n})();\n"]}